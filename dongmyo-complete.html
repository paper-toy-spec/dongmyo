<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no,viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">
<title>ë™ë¬˜ ê·€ì‹œì¥ Â· v1.0</title>
<style>
:root{
  --bg:#0b0b0c;--panel:#121213;--ink:#e8e0d8;--muted:#a89f96;--accent:#8b0000;--line:#2a2a2a;
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;background:radial-gradient(1100px circle at 50% -180px,#1a0000 0%,#0b0b0c 45%,#000 100%);
  color:var(--ink);font-family:"Noto Serif KR",Pretendard,system-ui,-apple-system,Segoe UI,Roboto,sans-serif}
.wrap{max-width:960px;margin:0 auto;padding:16px}
h1{margin:0 0 6px}
.btn, .choice{background:linear-gradient(180deg,#191919,#101010);border:1px solid #2b2b2b;color:var(--ink);
  padding:12px 14px;border-radius:10px;cursor:pointer;display:inline-block;
  -webkit-tap-highlight-color:transparent;
  user-select:none}
.btn:active,.choice:active{border-color:#922;background:linear-gradient(180deg,#3a0000,#260000)}
.title{min-height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center}
.game-title{font-size:40px;color:#e35;text-shadow:0 0 26px rgba(139,0,0,.55)}
.intro{white-space:pre-wrap;color:var(--muted);line-height:1.85;max-width:760px;margin:12px auto 18px}
.panel{background:linear-gradient(180deg,#171717,#0e0e0f);border:1px solid var(--line);border-radius:12px;padding:16px}
.story{min-height:220px;white-space:pre-wrap;line-height:1.9;overflow-y:auto;max-height:50vh}
.choices{margin-top:12px;display:grid;gap:10px}
.hud{display:none}
.hud.on{display:block}
.header{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
.h-title{font-weight:800;color:#e66}
.statbar{display:grid;grid-template-columns:repeat(6,1fr);gap:8px;margin:10px 0}
.slab{background:linear-gradient(180deg,#171717,#101012);border:1px solid #2a2a2a;border-radius:10px;padding:8px 10px;text-align:center;font-size:13px}
.slab .v{display:block;font-weight:800;margin-top:4px}
.bad{color:#f59}
.good{color:#9ef0b0}
.warn{color:#f6d37a}
.row{display:flex;gap:8px;flex-wrap:wrap;align-items:center;justify-content:center}
.inv{margin-top:10px;padding:10px;border:1px dashed #333;border-radius:10px;display:none}
.inv.on{display:block}
.tag{background:#151515;border:1px solid #333;padding:4px 8px;border-radius:999px;font-size:12px;margin:2px}
.kv{font-size:12px;color:#b9b0a6}
hr.sep{border:none;border-top:1px solid #272727;margin:10px 0}
.help{position:fixed;right:0;top:0;bottom:0;width:380px;max-width:94vw;background:#111;border-left:1px solid #2a2a2a;transform:translateX(100%);transition:.25s;z-index:50;overflow-y:auto}
.help.on{transform:translateX(0)}
.help .head{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid #2a2a2a}
.help .body{padding:12px;height:calc(100% - 52px);overflow:auto}
.small{font-size:12px;color:#9a8f85}
.prob{font-size:12px;color:#caa}
.tip{font-size:12px;color:#9ab1ff}
.notice{font-size:12px;color:#b7f59e}
@media (max-width:640px){
  .statbar{grid-template-columns:repeat(3,1fr)}
  .game-title{font-size:30px}
  .wrap{padding:10px}
  .btn, .choice{padding:14px 16px;font-size:14px}
}
</style>
</head>
<body>
<div class="wrap">

  <!-- TITLE -->
  <section class="title" id="title">
    <div>
      <div class="game-title">ë™ë¬˜ ê·€ì‹œì¥</div>
      <div class="intro" id="introText">
ìŒë ¥ ì´ˆí•˜ë£¨, ìƒë§(ä¸Šæœ›).

ê³¨ëª©ê¸¸ì€ ë‚® ë™ì•ˆì˜ í”ì ë“¤ë¡œ ì–´ì§€ëŸ½ë‹¤. ìˆ ì— ì·¨í•œ ì›ƒìŒì†Œë¦¬, íƒì‹œ ë¶ˆë¹›, ê³¨ë™í’ˆì  ì°½ê°€ì˜ í¬ë¯¸í•œ ë„¤ì˜¨ì‚¬ì¸.
ìƒì¸ë“¤ì€ ê°€ê²Œ ë¬¸ì„ ë‹«ê³ , ë²„ìŠ¤ëŠ” ë§ˆì§€ë§‰ ìŠ¹ê°ì„ ë‚´ë ¤ì£¼ê³ , ë„ë¡œ ìœ„ì—” ê°„ê°„ì´ ìë™ì°¨ ì†Œë¦¬ë§Œ ë‚¨ì•˜ë‹¤.
í‰ë²”í•œ ë™ë„¤, í‰ë²”í•œ ë°¤.

ë¹„ë¦¬í˜•ì‚¬ê°€ ë™ë¬˜ ì‚¬ë‹¹ ì•ì—ì„œ ë‹´ë°°ë¥¼ í”¼ìš°ê³  ìˆë‹¤.
ì—°ê¸°ê°€ í•˜ëŠ˜ë¡œ ì˜¬ë¼ê°”ë‹¤.

ê¹€ì •í˜¸ê°€ ìˆì—ˆë‹¤. ì œì„ìŠ¤ë„ ìˆì—ˆë‹¤. ê´‘ê³ ëŒ€í–‰ì‚¬ ì‚¬ì¥ë„.

ì•„ë¬´ë„ ë¨¼ì € ì˜¤ìê³  í•˜ì§€ ì•Šì•˜ëŠ”ë°.

"ë˜ ì™”ë„¤."

ì œì„ìŠ¤ê°€ ì›ƒì—ˆë‹¤. ì”ì“¸í•œ ì›ƒìŒì´ì—ˆë‹¤.

"ë­˜ ê¸°ëŒ€í•˜ëŠ” ê±°ì§€?"

ê¹€ì •í˜¸ê°€ ë¬¼ì—ˆë‹¤.

"ëª¨ë¥´ê² ì–´."

ì œì„ìŠ¤ê°€ ë‹µí–ˆë‹¤.

ë²½ì„ ë°”ë¼ë´¤ë‹¤. ì—¬ì „íˆ ê·¸ëƒ¥ ë²½ì´ì—ˆë‹¤.

í•˜ì§€ë§Œ ê°€ë”, ì •ë§ ê°€ë”.
ë°”ëŒì´ ë¶ˆë©´.
ë¬´ì–¸ê°€ ì—´ë¦¬ëŠ” ê²ƒ ê°™ì€ ê¸°ë¶„ì´ ë“¤ì—ˆë‹¤.

ì°©ê°ì´ì—ˆë‹¤.
ë¶„ëª… ì°©ê°ì´ì—ˆë‹¤.

ê·¸ëŸ°ë°ë„ ê·¸ë“¤ì€ ë§¤ì¼ ë°¤ ì™”ë‹¤.
ê¸°ë‹¤ë ¸ë‹¤.
ë¬´ì—‡ì„ ê¸°ë‹¤ë¦¬ëŠ”ì§€ë„ ëª¨ë¥¸ ì±„.

ì–´ë””ì„ ê°€ ë°©ìš¸ ì†Œë¦¬ê°€ ë“¤ë ¸ë‹¤.
ê³ ì–‘ì´ ëª©ì— ë‹¬ë¦° ë°©ìš¸ì´ì—ˆë‹¤. ê¸¸ê³ ì–‘ì´ê°€ ì§€ë‚˜ê°”ë‹¤.
ê·¸ë¿ì´ì—ˆë‹¤.
      </div>

      <div class="row">
        <button class="btn" id="btnEnter">ë²½ì„ ë°”ë¼ë³¸ë‹¤</button>
        <button class="btn" id="btnHelp">ë„ì›€ë§</button>
      </div>
    </div>
  </section>

  <!-- HUD -->
  <section class="hud" id="hud">
    <div class="header">
      <div>
        <div class="h-title">ë™ë¬˜ ê·€ì‹œì¥</div>
        <div class="small" id="subinfo"></div>
      </div>
      <div class="row">
        <button class="btn" id="btnHelp2">ë„ì›€ë§</button>
      </div>
    </div>

    <!-- Stats / Resources -->
    <div class="statbar">
      <div class="slab">ì´ì„±<div class="v" id="sReason">3</div></div>
      <div class="slab">ê°ì •<div class="v" id="sEmp">3</div></div>
      <div class="slab">ì§ê´€<div class="v" id="sInst">3</div></div>
      <div class="slab">ì‹œê°„<div class="v" id="rTime">60</div></div>
      <div class="slab">ì •ì‹ <div class="v" id="rPsy">70</div></div>
      <div class="slab">ë‹¨ì„œ<div class="v" id="rClue">0</div></div>
    </div>
    <div class="row kv">
      <span>ì£¼í™”: <b id="rCoin">3</b></span>
      <span>ì˜ì‹¬ë„(Heat): <b id="rHeat">0</b></span>
      <span>íŒíŠ¸ ì¡°ê°: <b id="rShard">0</b></span>
      <span>ë™í–‰ ë„ì›€ ì¿¨íƒ€ì„: <b id="rCD">0</b>í„´</span>
    </div>

    <div class="panel">
      <div class="story" id="story">â€¦</div>
      <div class="choices" id="choices"></div>
    </div>

    <div class="inv" id="inv">
      <div class="small" style="margin-bottom:6px">ì†Œì§€í’ˆ</div>
      <div id="tags"></div>
    </div>
  </section>

  <!-- HELP -->
  <aside class="help" id="help">
    <div class="head">
      <div style="font-weight:800;color:#e6dbd0">ë„ì›€ë§ / ê·œì¹™ / íŠœí† ë¦¬ì–¼</div>
      <button class="btn" id="btnHelpClose">ë‹«ê¸°</button>
    </div>
    <div class="body">
      <h3 style="margin:6px 0 8px;color:#e66">í•µì‹¬ ê·œì¹™</h3>
      <p class="small">
        â€¢ ëª©í‘œ: ì´ë¦„ ì—†ëŠ” ì§„ì‹¤ì— ë‹¿ì•„ ì§€í•˜ë¡œ ë‚´ë ¤ê°€ê³ , ë§ˆì§€ë§‰ì— ì„ íƒí•˜ë¼.<br>
        â€¢ ìƒì ì€ í•œ ë²ˆ ê±°ë˜í•˜ë©´ ì ê¹ë‹ˆë‹¤. (ì²« ê±°ë˜ í›„ ì¬ì…ì¥ ë¶ˆê°€)<br>
        â€¢ ê³¨ëª©ì—ì„œ NPCÂ·ì „íˆ¬Â·ë„ë°•Â·êµí™˜ìœ¼ë¡œ <b>íŒíŠ¸ ì¡°ê°</b>ê³¼ ë‹¨ì„œë¥¼ ëª¨ìœ¼ì„¸ìš”.<br>
        â€¢ <b>íŒíŠ¸ ì¡°ê° â‰¥ 3</b> ë˜ëŠ” <b>ë‹¨ì„œ â‰¥ 4</b>ë©´ ë°”ë‹¥ ë¬¸ì–‘ì´ ë°˜ì‘ â†’ ì§€í•˜ë¡œ í•˜ê°•.<br>
        â€¢ ì‹œê°„(60)ì€ ë§¤ í–‰ë™ì— ì†Œëª¨, 0ì´ë©´ ìƒˆë²½ ì—”ë”©. ì •ì‹  0ì´ë©´ ê´‘ê¸° ì—”ë”©.<br>
        â€¢ ë²„íŠ¼ì— <span class="tip">ì„±ê³µë¥  %</span>ì´ ë³´ì…ë‹ˆë‹¤. ë™í–‰ í˜¸ì¶œ/ì•„ì´í…œìœ¼ë¡œ ë³´ì • ê°€ëŠ¥.
      </p>
      <hr class="sep">
      <h4>ëŠ¥ë ¥ì¹˜</h4>
      <p class="small">
        â€¢ <b>ì´ì„±</b>: ìˆ˜ìˆ˜ê»˜ë¼/ë¶„ì„/í•´ë… ì„±ê³µë¥ â†‘<br>
        â€¢ <b>ê°ì •</b>: ì„¤ë“/êµì„­/êµí™˜/íŠ¹ì • ìƒì  í˜¸ê° ë³´ì •â†‘<br>
        â€¢ <b>ì§ê´€</b>: ì „íˆ¬/ë„ë°•/ìœ„í—˜íšŒí”¼/í–‰ìš´ ë³´ì •â†‘
      </p>
      <h4>ë™í–‰(ì¿¨ 2í„´)</h4>
      <p class="small">
        â€¢ í˜•ì‚¬: ì „íˆ¬ +10% (ì •ì‹  -5), ì œì„ìŠ¤: ë„ë°• +10% (ì£¼í™” -1),<br>
        â€¢ ê´‘ê³ ì‚¬ì¥: êµì„­/ìˆ˜ìˆ˜ê»˜ë¼ íŒíŠ¸ (ê°ì •â‰¥4 í•„ìš”), ê¹€ì •í˜¸: ê°€ê²© -1 (ìƒì  1íšŒ)
      </p>
      <h4>ì˜ì‹¬ë„(Heat)</h4>
      <p class="small">
        â€¢ ì‹¤íŒ¨/ë¬´ë¦¬í•œ í–‰ë™ ì‹œ +1. 3/6ì— ë§¤ë³µÂ·ê°€ê²©ì¸ìƒ ë“± ë¦¬ìŠ¤í¬ ì¦ê°€.
      </p>
      <h4>ì‹œê°„ëŒ€ ìƒì </h4>
      <p class="small">
        â€¢ ì´ˆê¸°ì—” 2~3ê³³, ì¤‘ë°˜ 3~4ê³³, ëìë½ 1ê³³ ë“± ê°€ë³€. í•¨ì • ìƒì  ë“±ì¥ ê°€ëŠ¥.
      </p>
      <p class="small notice">ë„ì›€ë§ì—” 'ëˆ„êµ¬'ì˜ ì´ë¦„ì´ ì—†ìŠµë‹ˆë‹¤. ëª¨ë“  ê±´ ì§ì ‘ ë°í˜€ì•¼ í•©ë‹ˆë‹¤.</p>
    </div>
  </aside>

</div>

<script>
/* ---------- UTIL ---------- */
const $ = s => document.querySelector(s);
const $$ = s => Array.from(document.querySelectorAll(s));
function rnd(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }
function clamp(v,a,b){ return Math.max(a, Math.min(b, v)); }

/* ---------- STATE ---------- */
const state = {
  scene: 'title',
  floor: 'G',
  char: null,
  stats: { reason:3, empathy:3, instinct:3 },
  res: { time:60, psyche:70, clues:0, coins:3 },
  meta: { heat:0, shards:0, turn:0, cd:0, pity:{fight:0,gamble:0,riddle:0} },
  inv: [],
  visitedShops: new Set(),
  lockedShops: new Set(),
  flags: { 
    marketSeen:false, 
    riddleHint:false,
    exploredAreas: {}
  },
};

/* ---------- DATA: SHOPS ---------- */
const SHOPS = [
  {
    id:'jewel',
    name:'ì˜í˜¼ì˜ ë³´ì„ìƒ',
    type:'riddle',
    openAt:'any',
    intro: `ìœ ë¦¬ ì§„ì—´ì¥ì— ê°ì •ì´ êµ³ì–´ ì•‰ì•„ ìˆì—ˆë‹¤. íŒŒë€ë¹›ì€ ì˜¤ë˜ëœ ìš¸ìŒ, ë¶‰ì€ë¹›ì€ ì…ìˆ ì˜ í‰í„°, ì´ˆë¡ë¹›ì€ ë§ë¼ë¶™ì€ ê·¸ë¦¬ì›€.
ìƒì¸ì€ ì›ƒëŠ”ì§€ ì•„ë‹Œì§€ ì•Œ ìˆ˜ ì—†ëŠ” ëª©ì†Œë¦¬ë¡œ ë§í–ˆë‹¤. 
"ì›í•˜ëŠ” ê±´ ì•Œì£ . ê°€ì§„ ê±¸ ëª¨ë¥¼ ë¿."`,
    riddle: {
      q:`"í•œ ì™•ì´ ìˆì—ˆìŠµë‹ˆë‹¤. 
ëª¨ë“  ìŠ¬í””ì„ íŒ”ì•„ ì™•êµ­ì„ ì§€ì¼°ê³ , ëª¨ë“  ë¶„ë…¸ë¥¼ íŒ”ì•„ í‰í™”ë¥¼ ìƒ€ìœ¼ë©°, ëª¨ë“  ê·¸ë¦¬ì›€ì„ íŒ”ì•„ ë¯¸ë˜ë¥¼ ì–»ì—ˆìŠµë‹ˆë‹¤.
ê·¸ëŠ” ì™œ ë¬´ë„ˆì¡Œì„ê¹Œìš”?"`,
      a:[
        { key:'ì¸ê°„ì„±ì˜ ìƒì‹¤', text:'ê°ì • ì—†ëŠ” ì™•ì€ ë” ì´ìƒ ì¸ê°„ì´ ì•„ë‹ˆì—ˆë‹¤', effect:()=>{ gain('clues',2); pushInv('ì§€í˜œì˜ ì¡°ê°'); msg('ìƒì¸ì€ ê³ ê°œë¥¼ ë„ë•ì˜€ë‹¤. "ê»ë°ê¸°ëŠ” ì˜¤ë˜ ëª» ê°‘ë‹ˆë‹¤." (ë‹¨ì„œ+2)'); } , pref:true },
        { key:'ë°±ì„±ì˜ ì´íƒˆ', text:'ë°±ì„±ë“¤ì´ ê°ì • ì—†ëŠ” ì™•ì„ ë”°ë¥´ì§€ ì•Šì•˜ë‹¤', effect:()=>{ gain('clues',1); msg('"ë°˜ì¯¤ì€ìš”."(ë‹¨ì„œ+1)'); } },
        { key:'ê¸°ì–µì˜ ì”ì¡´', text:'ê°ì •ì„ íŒ”ì•„ë„ ê¸°ì–µì€ ë‚¨ì•˜ë‹¤', effect:()=>{ state.stats.reason++; msg('"í¥ë¯¸ë¡œìš´ ê´€ì°°." (ì´ì„±+1)'); } }
      ]
    },
    items:[
      {name:'ìŠ¬í””ì˜ ì‚¬íŒŒì´ì–´', cost:{coins:2, psyche:10,time:6}, lore:'ìš¸ì§€ ëª»í•˜ëŠ” í‰ì˜¨. ë‹¨, ì˜¤ë˜ ë³´ë©´ ì°¨ê°‘ë‹¤.', effect:()=>{ pushInv('ìŠ¬í””ì˜ ì‚¬íŒŒì´ì–´'); state.flags.riddleHint=true; }},
      {name:'ë¶„ë…¸ì˜ ë£¨ë¹„', cost:{coins:2, psyche:5,time:6}, lore:'ë¶ˆë¡œ ì¥” ì •ì˜. ë‹¨, ì†ë°”ë‹¥ì´ íƒ„ë‹¤.', effect:()=>{ pushInv('ë¶„ë…¸ì˜ ë£¨ë¹„'); }},
      {name:'ê·¸ë¦¬ì›€ì˜ ì—ë©”ë„ë“œ', cost:{coins:1, psyche:8,time:6}, lore:'ë’¤ëŒì•„ë³´ì§€ ì•Šê²Œ í•´ì¤€ë‹¤. ëŒ€ì‹  ë‚´ì¼ì´ íë¦¿í•´ì§„ë‹¤.', effect:()=>{ pushInv('ê·¸ë¦¬ì›€ì˜ ì—ë©”ë„ë“œ'); }},
      {name:'í›„íšŒì˜ ë‹¤ì´ì•„ëª¬ë“œ', cost:{coins:3, psyche:12,time:8}, lore:'ê²°ì •ì„ ë˜ì§šê²Œ í•œë‹¤. ë‹¨, ë˜ëŒë¦´ ìˆ˜ ì—†ëŠ” ê²ƒë§Œ ì„ ëª…í•´ì§„ë‹¤.', effect:()=>{ pushInv('í›„íšŒì˜ ë‹¤ì´ì•„ëª¬ë“œ'); }}
    ],
  },
  { id:'memory', name:'ê¸°ì–µì—¼ìƒ‰ì†Œ', type:'trade', openAt:'any',
    intro:`í—ˆì—° ëˆˆë™ìì˜ ë…¸íŒŒ. ë¹„ë‹¨ì£¼ë¨¸ë‹ˆ ì…‹ì„ êº¼ë‚´ë©° ì¤‘ì–¼ê±°ë ¸ë‹¤. "ìŠì€ ì¤„ ì•Œì•˜ë˜ ê²ƒ, ìŠê³  ì‹¶ì—ˆë˜ ê²ƒ, ìŠì–´ì•¼ í–ˆë˜ ê²ƒ."`,
    items:[
      {name:'ì²«ì‚¬ë‘ì˜ ë§ˆì§€ë§‰ ì¸ì‚¬', cost:{coins:1,time:5,psyche:6}, lore:'ë”°ëœ»í•˜ì§€ë§Œ ì˜¤ë˜ ë³´ê´€í•˜ë©´ íë ¤ì§„ë‹¤.', effect:()=>{ pushInv('ì²«ì‚¬ë‘ì˜ ë§ˆì§€ë§‰ ì¸ì‚¬'); addShard(1); gain('clues',1); }},
      {name:'ê¹¨ë—í–ˆë˜ ë§ˆìŒ', cost:{coins:2,time:6,psyche:8}, lore:'ì ê¹ì˜ ìš©ê¸°. ë‹¤ìŒ ì„ íƒì´ ë¬´ê±°ì›Œì§„ë‹¤.', effect:()=>{ pushInv('ê¹¨ë—í–ˆë˜ ë§ˆìŒ'); addShard(1); gain('clues',1); }},
      {name:'í¬ë¯¸í•œ ì´ë¦„ ìª½ì§€', cost:{coins:1,time:5}, lore:'ë¬¼ì— ë²ˆì§„ í•„ê¸°ì²´. ììŒ í•˜ë‚˜ê°€ ë‚¨ëŠ”ë‹¤.', effect:()=>{ pushInv('ìª½ì§€(ììŒ)'); addShard(1); }}
    ]
  },
  { id:'reassemble', name:'ê³¼ê±° ì¬ì¡°ë¦½ì ', type:'trade', openAt:'any',
    intro:`ë‚˜ë¬´ìƒ ìœ„ì— ë¶„í•´ëœ íšŒì¤‘ì‹œê³„. ì£¼ì¸ì€ íƒœì—½ì„ ë“¤ì–´ ë³´ì´ë©° ë§í–ˆë‹¤. "ë¹ ì§„ ê±´ ëŠ˜ ì œì¼ ì‘ì€ ê±°ì§€."`,
    items:[
      {name:'íƒœì—½ ì¡°ê°', cost:{coins:1,time:5}, lore:'ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•ŠëŠ” ì¡°ê°. ê·¸ëŸ¬ë‚˜ ì—†ëŠ” ê²ƒë³´ë‹¨ ë‚«ë‹¤.', effect:()=>{ pushInv('íƒœì—½ ì¡°ê°'); addShard(1);} },
      {name:'ë‚¡ì€ ë‚˜ì‚¬ëª»', cost:{coins:1,time:4}, lore:'êµ¬ë©ì´ í—ê±°ìš´ ê¸°ì–µì— ë°•ëŠ”ë‹¤.', effect:()=>{ pushInv('ë‚¡ì€ ë‚˜ì‚¬ëª»'); }},
      {name:'ë¯¸ì„¸í•œ ìŠ¤í”„ë§', cost:{coins:1,time:4}, lore:'íŒ½íŒ½í• ìˆ˜ë¡ ì˜ ëŠì–´ì§„ë‹¤.', effect:()=>{ pushInv('ë¯¸ì„¸í•œ ìŠ¤í”„ë§'); }}
    ]
  },
  { id:'desire', name:'ìš•ë§ ë§¤ì…ì†Œ', type:'trade', openAt:'mid',
    intro:`ë¶‰ì€ í–¥ì´ ì½”ë¥¼ ì°”ë €ë‹¤. "ë¬´ì—‡ì„ ìƒê³  ì‹¶ìœ¼ì‹ ê°€ìš”?"`,
    items:[
      {name:'ê°€ë²¼ìš´ ì–‘ì‹¬', cost:{psyche:10,time:6}, lore:'ì£„ì±…ê°ì´ ëœ ë¬´ê²ë‹¤. ëŒ€ì‹  ì˜ì‹¬ì´ ë¹¨ë¦¬ ë¶™ëŠ”ë‹¤.', effect:()=>{ pushInv('ê°€ë²¼ìš´ ì–‘ì‹¬'); state.meta.heat++; }},
      {name:'ëˆ ëƒ„ìƒˆ', cost:{coins:1,time:4}, lore:'ì „ë¶€ê°€ ê·¸ ëƒ„ìƒˆë¡œ ë³´ì¸ë‹¤.', effect:()=>{ pushInv('ëˆ ëƒ„ìƒˆ'); }}
    ]
  },
  { id:'post', name:'ë§ìì˜ ìš°ì²´êµ­', type:'trade', openAt:'late',
    intro:`ê³µì¤‘ì— í¸ì§€ë“¤ì´ ë– ë‹¤ë…”ë‹¤. ìš°ì²´êµ­ì¥ì€ ì´ë¯¸ ì˜¤ë˜ì „ì— ì£½ì€ ë“¯í–ˆë‹¤. "ëˆ„êµ¬ì—ê²Œ ë³´ë‚¼ê¹Œìš”?"`,
    items:[
      {name:'ì‚¬ì£„ì˜ í¸ì§€', cost:{time:6,psyche:8}, lore:'ë‹µì€ ì˜¤ì§€ ì•ŠëŠ”ë‹¤. ë§ˆìŒì€ ê°€ë²¼ì›Œì§„ë‹¤.', effect:()=>{ pushInv('ì‚¬ì£„ì˜ í¸ì§€'); gain('clues',1);} },
      {name:'ì§ˆë¬¸ì˜ í¸ì§€', cost:{time:6,coins:1}, lore:'ê°€ë” ë‹µì¥ì´ ì˜¨ë‹¤. ëŒ€ê°œëŠ” ëŠ¦ë‹¤.', effect:()=>{ pushInv('ì§ˆë¬¸ì˜ í¸ì§€'); if(Math.random()<0.4){ addShard(1); msg('ëŠë¦° ë‹µì¥: íŒíŠ¸ ì¡°ê° +1'); }} }
    ]
  }
];

/* ---------- EXPLORATION DATA ---------- */
function alley(){
  state.scene='alley';
  setText(`ì‹œì¥ì„ ë– ë‚˜ ê³¨ëª©ì„ íƒí—˜í•œë‹¤.

ë¶‰ì€ ë“±ë¡± ì‚¬ì´ë¡œ ì´ì–´ì§„ ì¢ì€ ê¸¸ë“¤.
ì–´ë‘  ì†ì—ì„œ ë¬´ì–¸ê°€ ë°˜ì§ì´ëŠ” ê²ƒë“¤ì´ ë³´ì¸ë‹¤.
ë°œê±¸ìŒ í•˜ë‚˜í•˜ë‚˜ê°€ ê³¼ê±°ì˜ í”ì ì„ ë°ŸëŠ” ë“¯í•˜ë‹¤.

ì–´ëŠ ê¸¸ë¡œ í–¥í• ê¹Œ?`);
  
  const exploredCount = Object.keys(state.flags.exploredAreas || {}).length;
  const choices = [];
  
  // ê¸°ë³¸ íƒí—˜ ì§€ì—­ë“¤
  choices.push({text:'ğŸŒ… ë™ìª½ ê³¨ëª© - 1956ë…„ì˜ ê¸°ì–µ', fn:()=>exploreEast()});
  choices.push({text:'ğŸŒ† ì„œìª½ ë’·ê³¨ëª© - ë¦¬ë¨¼ì˜ ê·¸ë¦¼ì', fn:()=>exploreWest()});
  choices.push({text:'ğŸŒ™ ë¶ìª½ ê´‘ì¥ - ì‹œê¶ì°½ì¥ì˜ ì†Œêµ´', fn:()=>exploreNorth()});
  choices.push({text:'ğŸšï¸ ë‚¨ìª½ ì°½ê³  - ë‡Œë¬¼ì˜ ì¦ê±°', fn:()=>exploreSouth()});
  
  // íŠ¹ë³„ ì§€ì—­ (ì¡°ê±´ë¶€ ê°œë°©)
  if (exploredCount >= 2) {
    choices.push({text:'ğŸ—ï¸ ì˜¥ìƒ - ë¶€ì„œì§„ ê°„íŒë“¤', fn:()=>exploreRoof()});
  }
  if (exploredCount >= 3) {
    choices.push({text:'ğŸ•³ï¸ ì§€í•˜ í†µë¡œ - ìˆ¨ê²¨ì§„ ë°©', fn:()=>exploreBasement()});
  }
  
  // ëœë¤ ì´ë²¤íŠ¸
  if (Math.random() < 0.3) {
    choices.push({text:'ğŸ‘¤ ìˆ˜ìƒí•œ ì¸ë¬¼ê³¼ ì¡°ìš°', fn:()=>npcEncounter()});
  }
  if (Math.random() < 0.3) {
    choices.push({text:'âš”ï¸ ê·¸ë¦¼ìì™€ ëŒ€ì¹˜', fn:()=>lightFight()});
  }
  if (Math.random() < 0.3) {
    choices.push({text:'ğŸ² ë„ë°•íŒ ë°œê²¬', fn:()=>gambling()});
  }
  
  choices.push({text:'ğŸ›ï¸ ìƒì ê°€ë¡œ ëŒì•„ê°„ë‹¤', fn:openMarket});
  
  setChoices(choices);
}

function exploreEast(){
  if (!state.flags.exploredAreas) state.flags.exploredAreas = {};
  
  if (state.flags.exploredAreas.east) {
    setText(`ë™ìª½ ê³¨ëª© - ì´ë¯¸ íƒí—˜í•œ ê³³

ì—¬ì „íˆ 1956ë…„ì˜ ê¸°ì–µì´ ë‚¨ì•„ìˆë‹¤.
í—¤ì–´ì§„ ì˜·ê° ì¡°ê°ì´ ë°”ëŒì— ë‚ ë¦°ë‹¤.
ë” ì´ìƒ ìƒˆë¡œìš´ ë°œê²¬ì€ ì—†ì„ ê²ƒ ê°™ë‹¤.`);
    setChoices([
      {text:'ë‹¤ë¥¸ ê³³ì„ íƒí—˜í•œë‹¤', fn:alley},
      {text:'ìƒì ê°€ë¡œ ëŒì•„ê°„ë‹¤', fn:openMarket}
    ]);
    return;
  }
  
  const isRelevant = (state.char === 'ê¹€ì •í˜¸');
  spend({time:6});
  
  setText(`ë™ìª½ ê³¨ëª© - 1956ë…„ì˜ ê¸°ì–µ

ì¢ì€ ê³¨ëª© ëì— ë‚¡ì€ ê¸°ì°¨ì—­ ê°„íŒì´ ë³´ì¸ë‹¤.
"ì„œìš¸ì—­ â† 2km"
í˜ì¸íŠ¸ê°€ ë²—ê²¨ì ¸ ê²¨ìš° ì•Œì•„ë³¼ ìˆ˜ ìˆë‹¤.

ë°”ë‹¥ì—ëŠ” ì‘ì€ ì˜·ê° ì¡°ê°ì´ í©ì–´ì ¸ ìˆë‹¤.
ì–´ë¦°ì•„ì´ ê²ƒìœ¼ë¡œ ë³´ì´ëŠ” ë¶„í™ìƒ‰ ë¦¬ë³¸.
68ë…„ì´ í˜ë €ì§€ë§Œ ì•„ì§ë„ ì„ ëª…í•˜ë‹¤.

ë²½ì—ëŠ” ëˆ„êµ°ê°€ ê¸ì–´ë†“ì€ ê¸€ì”¨ê°€ ìˆë‹¤.
"ì˜¤ë¹ ... ê³ ë§ˆì›Œ..."

${isRelevant ? 'ë‹¹ì‹ ì˜ ê°€ìŠ´ì´ ì•„í”„ê²Œ ì¡°ì—¬ì˜¨ë‹¤. ì´ê³³ì—ì„œ ë¬´ìŠ¨ ì¼ì´...' : 'ëˆ„êµ°ê°€ì˜ ì•„í”ˆ ê¸°ì–µì´ ì„œë ¤ìˆëŠ” ê³³ ê°™ë‹¤.'}`);
  
  // ìºë¦­í„°ë³„ ì°¨ë“± ë³´ìƒ
  if (isRelevant) {
    gain('clues', 2);
    losePsy(8);
    pushInv('ë¶„í™ìƒ‰ ë¦¬ë³¸');
    msg('ê¹Šì€ ê¸°ì–µì´ ë˜ì‚´ì•„ë‚¬ë‹¤. (ë‹¨ì„œ+2, ì •ì‹ -8)');
  } else {
    gain('clues', 1);
    losePsy(3);
    msg('ì˜¤ë˜ëœ ìŠ¬í””ì´ ëŠê»´ì§„ë‹¤. (ë‹¨ì„œ+1, ì •ì‹ -3)');
  }
  
  state.flags.exploredAreas.east = true;
  
  setChoices([
    {text:'ë” ê¹Šì´ ë“¤ì–´ê°€ ë³¸ë‹¤', fn:()=>deepExploreEast()},
    {text:'ë‹¤ë¥¸ ê³³ì„ íƒí—˜í•œë‹¤', fn:alley},
    {text:'ìƒì ê°€ë¡œ ëŒì•„ê°„ë‹¤', fn:openMarket}
  ]);
}

function deepExploreEast(){
  spend({time:4, psyche:5});
  
  setText(`ë™ìª½ ê³¨ëª© ê¹Šìˆ™ì´

ë” ì•ˆìª½ìœ¼ë¡œ ë“¤ì–´ê°€ì ì‘ì€ ë°©ì´ ë‚˜íƒ€ë‚¬ë‹¤.
ë²½ì—ëŠ” ë‚¡ì€ ì‚¬ì§„ë“¤ì´ ë¶™ì–´ìˆë‹¤.
í‘ë°±ì‚¬ì§„ ì† ë‘ ì•„ì´ê°€ ì†ì„ ì¡ê³  ì›ƒê³  ìˆë‹¤.

ì‚¬ì§„ ë’¤ì— ì“°ì—¬ì§„ ê¸€ì”¨:
"1954ë…„ ê²¨ìš¸"

ì±…ìƒ ìœ„ì—ëŠ” íœìœ¼ë¡œ ì“´ í¸ì§€ê°€ ìˆë‹¤.
ì‰í¬ê°€ ë²ˆì ¸ ì½ê¸° ì–´ë µì§€ë§Œ...

"ì˜¤ë¹ , ë‚˜ ë¯¸êµ­ ì˜ ë„ì°©í–ˆì–´.
ì—¬ê¸° ë³‘ì› ì •ë§ ì¢‹ì•„. ê³§ ë‚˜ì„ ê²ƒ ê°™ì•„.
ì˜¤ë¹ ëŠ” ë‚˜ë¥¼ ë²„ë¦° ê²Œ ì•„ë‹ˆë¼ ì‚´ë ¤ì¤€ ê±°ë¼ëŠ” ê±¸ ì•Œì•„.
ì‚¬ë‘í•´..."

ë§ˆì§€ë§‰ í¸ì§€ëŠ” ë³‘ì› í¸ì§€ì§€ì— ì“°ì—¬ìˆë‹¤.
"ì˜¤ë¹ , ë‚˜ ì´ì œ ë– ë‚  ê²ƒ ê°™ì•„. í‰ìƒ ê¸°ë‹¤ë ¸ì–´.
í•œ ë²ˆë„ ì˜¤ë¹ ë¥¼ ì›ë§í•œ ì  ì—†ì–´.
ì œì„ìŠ¤ë¼ëŠ” ì•„ì´ë¥¼ ì…ì–‘í–ˆì–´. 
ì„¸ ë²ˆì´ë‚˜ ë²„ë ¤ì§„ ì•„ì´ì•¼. ë‚´ê°€ êµ¬í•´ì¤¬ì–´."`);
  
  addShard(1);
  gain('clues', 1);
  msg('68ë…„ê°„ì˜ í¸ì§€ë¥¼ ë°œê²¬í–ˆë‹¤. (íŒíŠ¸ ì¡°ê°+1, ë‹¨ì„œ+1)');
  
  setChoices([
    {text:'í¸ì§€ë¥¼ ëª¨ë‘ ê°€ì ¸ê°„ë‹¤', fn:()=>{ pushInv('68ë…„ê°„ì˜ í¸ì§€'); alley(); }},
    {text:'ì¡°ìš©íˆ ë°©ì„ ë‚˜ì˜¨ë‹¤', fn:alley}
  ]);
}

function exploreWest(){
  if (!state.flags.exploredAreas) state.flags.exploredAreas = {};
  
  if (state.flags.exploredAreas.west) {
    setText(`ì„œìª½ ë’·ê³¨ëª© - ì´ë¯¸ íƒí—˜í•œ ê³³

ìˆ«ìë“¤ì˜ ì”í–¥ì´ ì—¬ì „íˆ ë§´ëŒê³  ìˆë‹¤.
ë” ì´ìƒ ìƒˆë¡œìš´ ë°œê²¬ì€ ì—†ì„ ê²ƒ ê°™ë‹¤.`);
    setChoices([
      {text:'ë‹¤ë¥¸ ê³³ì„ íƒí—˜í•œë‹¤', fn:alley},
      {text:'ìƒì ê°€ë¡œ ëŒì•„ê°„ë‹¤', fn:openMarket}
    ]);
    return;
  }
  
  const isRelevant = (state.char === 'ì œì„ìŠ¤');
  spend({time:6});
  
  setText(`ì„œìª½ ë’·ê³¨ëª© - ë¦¬ë¨¼ì˜ ê·¸ë¦¼ì

ê³¨ëª© ë²½ì— ìˆ«ìë“¤ì´ ìƒˆê²¨ì ¸ ìˆë‹¤.
í•˜ì§€ë§Œ ì´ìƒí•˜ë‹¤. ìˆ«ìë“¤ì´ ê³„ì† ë³€í•˜ê³  ìˆë‹¤.

ì²˜ìŒì—ëŠ” ì •í™•í•œ ì¬ë¬´ì œí‘œì˜€ì§€ë§Œ,
ì§€ì¼œë³´ê³  ìˆìœ¼ë©´ ì„œì„œíˆ ì™œê³¡ë˜ì–´ê°„ë‹¤.