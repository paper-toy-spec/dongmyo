<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>동묘 귀시장 완전판</title>
  <style>
    body { background: #111; color: #eee; margin: 0; font-family: 'Noto Sans KR', sans-serif; text-align: center;}
    #startScreen, #charSelect, #gameScreen, #ending { display:none; }
    #hud { position: fixed; bottom: 0; width: 100%; background: #222; padding: 10px; display: flex; justify-content: space-around; border-top: 2px solid #444; font-size: 1em; }
    #eventBox { position: fixed; top: 5%; left: 10%; width: 80%; height: 85%; background: #eee; color: #111; border: 2px solid #555; padding: 20px; overflow-y: auto; display: none; z-index: 1000; text-align: left;}
    button { margin: 6px; padding: 10px 18px; background: #444; color: #eee; border: none; cursor: pointer; font-size: 1em; }
    button:hover { background: #666; }
    .choiceBtn { display:block; margin: 8px auto; width: 60%; }
    .fadeout { animation: fadeout 2s forwards; }
    @keyframes fadeout { to { opacity: 0; } }
    .shake { animation: shake 0.5s; }
    @keyframes shake {
      0% { transform: translate(0, 0); }
      25% { transform: translate(-5px, 0); }
      50% { transform: translate(5px, 0); }
      75% { transform: translate(-5px, 0); }
      100% { transform: translate(0, 0); }
    }
    .ending-red { background:#400; color:#fff; }
    .ending-blue { background:#004; color:#fff; }
    .ending-bw { background:#000; color:#ddd; filter: grayscale(100%);}
  </style>
</head>
<body>

  <!-- 시작 화면 -->
  <div id="startScreen">
    <h1>동묘 귀시장</h1>
    <p>
      "기억을 사고파는 시장, 잃어버린 자와 대신 남은 자들의 이야기.<br>
      동서남북 골목마다 이상한 가게들이 있고, 지하에는 더 깊은 어둠이 기다린다.<br>
      네 명의 인물은 누군가를 대신해 귀시장에 발을 들였고, 이제 기억의 수수께끼를 풀어야 한다."
    </p>
    <button onclick="goCharSelect()">게임 시작</button>
  </div>

  <!-- 캐릭터 선택 -->
  <div id="charSelect">
    <h2>캐릭터를 선택하세요</h2>
    <button onclick="startGame('김정호')">김정호 (사체업자, 경매 특화)</button><br>
    <button onclick="startGame('제임스')">제임스 (S그룹 전무, 도박 특화)</button><br>
    <button onclick="startGame('광고사장')">광고대행사 사장 (거래/설득 특화)</button><br>
    <button onclick="startGame('비리형사')">비리형사 (수사/전투 특화)</button>
  </div>

  <!-- 본 게임 -->
  <div id="gameScreen">
    <div id="eventBox"></div>
    <div id="hud">
      <span id="coins">주화: 10</span>
      <span id="sanity">이성: 100</span>
      <span id="insight">통찰: 0</span>
      <span id="time">시간: 100</span>
      <button onclick="explore()">탐험</button>
      <button onclick="runBasementEvent()">지하 탐색</button>
    </div>
  </div>

  <!-- 엔딩 -->
  <div id="ending"></div>

<script>
  // 초기 화면
  document.getElementById('startScreen').style.display='block';

  // 상태
  const state = {
    res: { coins:10, sanity:100, insight:0, time:100 },
    character:null,
    floor:1,
    companions:["김정호","제임스","광고사장","비리형사"],
    activeEffects:[]
  };

  function goCharSelect(){
    document.getElementById('startScreen').style.display='none';
    document.getElementById('charSelect').style.display='block';
  }

  function startGame(ch){
    state.character = ch;
    // 플레이어 선택 캐릭터만 제외
    state.companions = state.companions.filter(c=>c!==ch);
    document.getElementById('charSelect').style.display='none';
    document.getElementById('gameScreen').style.display='block';
    msg(`<strong>${ch}</strong>가 선택되었습니다. 나머지 3명은 동료로 함께 합니다.`);
    updateHUD();
  }

  // HUD 업데이트
  function updateHUD(){
    document.getElementById('coins').textContent = `주화: ${state.res.coins}`;
    document.getElementById('sanity').textContent = `이성: ${state.res.sanity}`;
    document.getElementById('insight').textContent = `통찰: ${state.res.insight}`;
    document.getElementById('time').textContent = `시간: ${state.res.time}`;
  }

  function msg(html){ 
    const box=document.getElementById('eventBox'); 
    box.style.display='block'; 
    box.innerHTML = `<p>${html}</p>`; 
  }

  // 탐험 (랜덤 이벤트)
  function explore(){
    const r = Math.random();
    if(r<0.3) hallucinationEvent();
    else if(r<0.5) shopEvent();
    else if(r<0.7) auctionEvent();
    else if(r<0.9) gamblingEvent();
    else villainEvent();
    endTurn();
  }

  // 환시 이벤트 예시
  function hallucinationEvent(){
    msg("👁 환시가 나타난다... 어딘가 낯선 풍경이 보인다.");
    state.res.sanity -= 2;
    updateHUD();
  }

  // 상점 이벤트 예시
  function shopEvent(){
    msg("🛒 시장 상인을 만났다. 주화로 거래할 수 있다.");
    state.res.coins -= 1;
    state.res.insight += 1;
    updateHUD();
  }

  // 경매 이벤트 예시
  function auctionEvent(){
    msg("📢 경매가 열린다. 동료 NPC도 경쟁자로 참여한다!");
    state.res.coins -= 2;
    updateHUD();
  }

  // 도박 이벤트 예시
  function gamblingEvent(){
    msg("🎲 도박판에 앉았다. 주화를 걸고 승부한다.");
    if(Math.random()<0.5){ state.res.coins +=2; msg("승리! 주화 +2"); }
    else { state.res.coins -=2; msg("패배... 주화 -2"); }
    updateHUD();
  }

  // 빌런 이벤트 예시
  function villainEvent(){
    msg("⚔️ 무법자가 나타났다! 동료와 함께 싸운다.");
    state.res.sanity -= 5;
    updateHUD();
  }

  // 지하 탐색
  function runBasementEvent(){
    msg(`지하 ${state.floor}층으로 내려간다...`);
    state.floor++;
    if(state.floor===4) finalBoss();
    endTurn();
  }

  // 최종 보스/엔딩
  function finalBoss(){
    msg("칠흑의 관이 등장했다... 모든 동료와 힘을 합쳐야 한다!");
    endGame("모든 기억을 되찾고 귀시장에서 탈출했다.", "ending-blue");
  }

  // 엔딩 처리
  function endGame(text, style){
    document.getElementById('gameScreen').style.display='none';
    const end=document.getElementById('ending');
    end.className=style;
    end.style.display='block';
    end.innerHTML=`<h1>엔딩</h1><p>${text}</p>`;
  }

  // 턴 종료
  function endTurn(){
    state.res.time--;
    if(state.res.time<=0) endGame("시간이 다했다. 귀시장에 영원히 갇혔다.", "ending-red");
    updateHUD();
  }

</script>
</body>
</html>
