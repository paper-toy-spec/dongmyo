<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë™ë¬˜ ê·€ì‹œì¥ ì™„ì „íŒ</title>
  <style>
    body { background: #111; color: #eee; margin: 0; font-family: 'Noto Sans KR', sans-serif; text-align: center;}
    #startScreen, #charSelect, #gameScreen, #ending { display:none; }
    #hud { position: fixed; bottom: 0; width: 100%; background: #222; padding: 10px; display: flex; justify-content: space-around; border-top: 2px solid #444; font-size: 1em; }
    #eventBox { position: fixed; top: 5%; left: 10%; width: 80%; height: 85%; background: #eee; color: #111; border: 2px solid #555; padding: 20px; overflow-y: auto; display: none; z-index: 1000; text-align: left;}
    button { margin: 6px; padding: 10px 18px; background: #444; color: #eee; border: none; cursor: pointer; font-size: 1em; }
    button:hover { background: #666; }
    .choiceBtn { display:block; margin: 8px auto; width: 60%; }
    .fadeout { animation: fadeout 2s forwards; }
    @keyframes fadeout { to { opacity: 0; } }
    .shake { animation: shake 0.5s; }
    @keyframes shake {
      0% { transform: translate(0, 0); }
      25% { transform: translate(-5px, 0); }
      50% { transform: translate(5px, 0); }
      75% { transform: translate(-5px, 0); }
      100% { transform: translate(0, 0); }
    }
    .ending-red { background:#400; color:#fff; }
    .ending-blue { background:#004; color:#fff; }
    .ending-bw { background:#000; color:#ddd; filter: grayscale(100%);}
  </style>
</head>
<body>

  <!-- ì‹œì‘ í™”ë©´ -->
  <div id="startScreen">
    <h1>ë™ë¬˜ ê·€ì‹œì¥</h1>
    <p>
      "ê¸°ì–µì„ ì‚¬ê³ íŒŒëŠ” ì‹œì¥, ìƒì–´ë²„ë¦° ìì™€ ëŒ€ì‹  ë‚¨ì€ ìë“¤ì˜ ì´ì•¼ê¸°.<br>
      ë™ì„œë‚¨ë¶ ê³¨ëª©ë§ˆë‹¤ ì´ìƒí•œ ê°€ê²Œë“¤ì´ ìˆê³ , ì§€í•˜ì—ëŠ” ë” ê¹Šì€ ì–´ë‘ ì´ ê¸°ë‹¤ë¦°ë‹¤.<br>
      ë„¤ ëª…ì˜ ì¸ë¬¼ì€ ëˆ„êµ°ê°€ë¥¼ ëŒ€ì‹ í•´ ê·€ì‹œì¥ì— ë°œì„ ë“¤ì˜€ê³ , ì´ì œ ê¸°ì–µì˜ ìˆ˜ìˆ˜ê»˜ë¼ë¥¼ í’€ì–´ì•¼ í•œë‹¤."
    </p>
    <button onclick="goCharSelect()">ê²Œì„ ì‹œì‘</button>
  </div>

  <!-- ìºë¦­í„° ì„ íƒ -->
  <div id="charSelect">
    <h2>ìºë¦­í„°ë¥¼ ì„ íƒí•˜ì„¸ìš”</h2>
    <button onclick="startGame('ê¹€ì •í˜¸')">ê¹€ì •í˜¸ (ì‚¬ì²´ì—…ì, ê²½ë§¤ íŠ¹í™”)</button><br>
    <button onclick="startGame('ì œì„ìŠ¤')">ì œì„ìŠ¤ (Sê·¸ë£¹ ì „ë¬´, ë„ë°• íŠ¹í™”)</button><br>
    <button onclick="startGame('ê´‘ê³ ì‚¬ì¥')">ê´‘ê³ ëŒ€í–‰ì‚¬ ì‚¬ì¥ (ê±°ë˜/ì„¤ë“ íŠ¹í™”)</button><br>
    <button onclick="startGame('ë¹„ë¦¬í˜•ì‚¬')">ë¹„ë¦¬í˜•ì‚¬ (ìˆ˜ì‚¬/ì „íˆ¬ íŠ¹í™”)</button>
  </div>

  <!-- ë³¸ ê²Œì„ -->
  <div id="gameScreen">
    <div id="eventBox"></div>
    <div id="hud">
      <span id="coins">ì£¼í™”: 10</span>
      <span id="sanity">ì´ì„±: 100</span>
      <span id="insight">í†µì°°: 0</span>
      <span id="time">ì‹œê°„: 100</span>
      <button onclick="explore()">íƒí—˜</button>
      <button onclick="runBasementEvent()">ì§€í•˜ íƒìƒ‰</button>
    </div>
  </div>

  <!-- ì—”ë”© -->
  <div id="ending"></div>

<script>
  // ì´ˆê¸° í™”ë©´
  document.getElementById('startScreen').style.display='block';

  // ìƒíƒœ
  const state = {
    res: { coins:10, sanity:100, insight:0, time:100 },
    character:null,
    floor:1,
    companions:["ê¹€ì •í˜¸","ì œì„ìŠ¤","ê´‘ê³ ì‚¬ì¥","ë¹„ë¦¬í˜•ì‚¬"],
    activeEffects:[]
  };

  function goCharSelect(){
    document.getElementById('startScreen').style.display='none';
    document.getElementById('charSelect').style.display='block';
  }

  function startGame(ch){
    state.character = ch;
    // í”Œë ˆì´ì–´ ì„ íƒ ìºë¦­í„°ë§Œ ì œì™¸
    state.companions = state.companions.filter(c=>c!==ch);
    document.getElementById('charSelect').style.display='none';
    document.getElementById('gameScreen').style.display='block';
    msg(`<strong>${ch}</strong>ê°€ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤. ë‚˜ë¨¸ì§€ 3ëª…ì€ ë™ë£Œë¡œ í•¨ê»˜ í•©ë‹ˆë‹¤.`);
    updateHUD();
  }

  // HUD ì—…ë°ì´íŠ¸
  function updateHUD(){
    document.getElementById('coins').textContent = `ì£¼í™”: ${state.res.coins}`;
    document.getElementById('sanity').textContent = `ì´ì„±: ${state.res.sanity}`;
    document.getElementById('insight').textContent = `í†µì°°: ${state.res.insight}`;
    document.getElementById('time').textContent = `ì‹œê°„: ${state.res.time}`;
  }

  function msg(html){ 
    const box=document.getElementById('eventBox'); 
    box.style.display='block'; 
    box.innerHTML = `<p>${html}</p>`; 
  }

  // íƒí—˜ (ëœë¤ ì´ë²¤íŠ¸)
  function explore(){
    const r = Math.random();
    if(r<0.3) hallucinationEvent();
    else if(r<0.5) shopEvent();
    else if(r<0.7) auctionEvent();
    else if(r<0.9) gamblingEvent();
    else villainEvent();
    endTurn();
  }

  // í™˜ì‹œ ì´ë²¤íŠ¸ ì˜ˆì‹œ
  function hallucinationEvent(){
    msg("ğŸ‘ í™˜ì‹œê°€ ë‚˜íƒ€ë‚œë‹¤... ì–´ë”˜ê°€ ë‚¯ì„  í’ê²½ì´ ë³´ì¸ë‹¤.");
    state.res.sanity -= 2;
    updateHUD();
  }

  // ìƒì  ì´ë²¤íŠ¸ ì˜ˆì‹œ
  function shopEvent(){
    msg("ğŸ›’ ì‹œì¥ ìƒì¸ì„ ë§Œë‚¬ë‹¤. ì£¼í™”ë¡œ ê±°ë˜í•  ìˆ˜ ìˆë‹¤.");
    state.res.coins -= 1;
    state.res.insight += 1;
    updateHUD();
  }

  // ê²½ë§¤ ì´ë²¤íŠ¸ ì˜ˆì‹œ
  function auctionEvent(){
    msg("ğŸ“¢ ê²½ë§¤ê°€ ì—´ë¦°ë‹¤. ë™ë£Œ NPCë„ ê²½ìŸìë¡œ ì°¸ì—¬í•œë‹¤!");
    state.res.coins -= 2;
    updateHUD();
  }

  // ë„ë°• ì´ë²¤íŠ¸ ì˜ˆì‹œ
  function gamblingEvent(){
    msg("ğŸ² ë„ë°•íŒì— ì•‰ì•˜ë‹¤. ì£¼í™”ë¥¼ ê±¸ê³  ìŠ¹ë¶€í•œë‹¤.");
    if(Math.random()<0.5){ state.res.coins +=2; msg("ìŠ¹ë¦¬! ì£¼í™” +2"); }
    else { state.res.coins -=2; msg("íŒ¨ë°°... ì£¼í™” -2"); }
    updateHUD();
  }

  // ë¹ŒëŸ° ì´ë²¤íŠ¸ ì˜ˆì‹œ
  function villainEvent(){
    msg("âš”ï¸ ë¬´ë²•ìê°€ ë‚˜íƒ€ë‚¬ë‹¤! ë™ë£Œì™€ í•¨ê»˜ ì‹¸ìš´ë‹¤.");
    state.res.sanity -= 5;
    updateHUD();
  }

  // ì§€í•˜ íƒìƒ‰
  function runBasementEvent(){
    msg(`ì§€í•˜ ${state.floor}ì¸µìœ¼ë¡œ ë‚´ë ¤ê°„ë‹¤...`);
    state.floor++;
    if(state.floor===4) finalBoss();
    endTurn();
  }

  // ìµœì¢… ë³´ìŠ¤/ì—”ë”©
  function finalBoss(){
    msg("ì¹ í‘ì˜ ê´€ì´ ë“±ì¥í–ˆë‹¤... ëª¨ë“  ë™ë£Œì™€ í˜ì„ í•©ì³ì•¼ í•œë‹¤!");
    endGame("ëª¨ë“  ê¸°ì–µì„ ë˜ì°¾ê³  ê·€ì‹œì¥ì—ì„œ íƒˆì¶œí–ˆë‹¤.", "ending-blue");
  }

  // ì—”ë”© ì²˜ë¦¬
  function endGame(text, style){
    document.getElementById('gameScreen').style.display='none';
    const end=document.getElementById('ending');
    end.className=style;
    end.style.display='block';
    end.innerHTML=`<h1>ì—”ë”©</h1><p>${text}</p>`;
  }

  // í„´ ì¢…ë£Œ
  function endTurn(){
    state.res.time--;
    if(state.res.time<=0) endGame("ì‹œê°„ì´ ë‹¤í–ˆë‹¤. ê·€ì‹œì¥ì— ì˜ì›íˆ ê°‡í˜”ë‹¤.", "ending-red");
    updateHUD();
  }

</script>
</body>
</html>
